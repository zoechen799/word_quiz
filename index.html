<div class="container">
    <div class="word-display">
        <h2 id="current-word"></h2>
    </div>
    <div class="input-section">
        <input type="text" id="answer-input" placeholder="请输入中文含义">
        <button id="submit-btn">提交</button>
        <button id="next-btn">下一个</button>
    </div>
</div>

<!-- 添加对话框 -->
<div id="result-dialog" class="dialog" style="display: none;">
    <div class="dialog-content">
        <h3 id="dialog-title"></h3>
        <p id="correct-answer"></p>
        <div class="dialog-buttons">
            <button id="add-wrong-list-btn">加入错词本</button>
            <button id="next-word-btn">下一题</button>
        </div>
    </div>
</div>

<style>
/* 添加对话框样式 */
.dialog {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
}

.dialog-content {
    background-color: white;
    margin: 15% auto;
    padding: 20px;
    width: 80%;
    max-width: 500px;
    border-radius: 5px;
    text-align: center;
}

.dialog-buttons {
    margin-top: 20px;
}

.dialog-buttons button {
    margin: 0 10px;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

#add-wrong-list-btn {
    background-color: #ff4444;
    color: white;
}

#next-word-btn {
    background-color: #4CAF50;
    color: white;
}
</style>

<script>
let currentWord = '';

async function checkAnswer(answer) {
    try {
        const response = await fetch('/api/check-answer', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                username: 'test_user',
                answer: answer
            })
        });
        const result = await response.json();
        
        // 显示对话框
        const dialog = document.getElementById('result-dialog');
        const dialogTitle = document.getElementById('dialog-title');
        const correctAnswer = document.getElementById('correct-answer');
        
        dialogTitle.textContent = result.passed ? "恭喜正确！" : "回答错误";
        correctAnswer.textContent = `正确答案：${result.correct_meaning}`;
        dialog.style.display = 'block';
        
        // 如果答案错误，自动加入错词本
        if (!result.passed) {
            await addToWrongList();
        }
        
        return result.passed;
    } catch (error) {
        console.error('Error:', error);
    }
}

async function addToWrongList() {
    try {
        await fetch('/api/add-to-wrong-list', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                username: 'test_user',
                word: currentWord
            })
        });
    } catch (error) {
        console.error('Error adding to wrong list:', error);
    }
}

async function getNextWord() {
    try {
        const response = await fetch('/api/next-word', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                username: 'test_user'
            })
        });
        const data = await response.json();
        currentWord = data.word;
        document.getElementById('current-word').textContent = data.word;
        document.getElementById('answer-input').value = '';
        document.getElementById('result-dialog').style.display = 'none';
    } catch (error) {
        console.error('Error:', error);
    }
}

// 页面加载时获取第一个单词
window.onload = getNextWord;

// 提交按钮点击事件
document.getElementById('submit-btn').addEventListener('click', async () => {
    const answer = document.getElementById('answer-input').value;
    await checkAnswer(answer);
});

// 回车键提交
document.getElementById('answer-input').addEventListener('keypress', async (e) => {
    if (e.key === 'Enter') {
        const answer = e.target.value;
        await checkAnswer(answer);
    }
});

// 下一题按钮点击事件（对话框中的）
document.getElementById('next-word-btn').addEventListener('click', getNextWord);

// 加入错词本按钮点击事件
document.getElementById('add-wrong-list-btn').addEventListener('click', async () => {
    await addToWrongList();
    await getNextWord();
});

// Next按钮点击事件
document.getElementById('next-btn').addEventListener('click', getNextWord);
</script> 